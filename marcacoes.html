<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marcações | Monalisa Essence</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/marcar.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>

  <header>
      <div class="interface">
        <section class="icon">
            <img class="logo" src="https://i.postimg.cc/K8q4m0Vv/6508-F792-1-F7-C-4-A59-B00-A-86-D8-B7-CFA0-CF.png" alt="Logo do Site" title="Logotipo">
      </section>

      <!-- Botão hamburguer -->
        <div class="menu-toggle" id="menu-toggle">
          <i class="fas fa-bars"></i>
        </div>

       <section class="menu-desktop">
          <nav>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="#Galeria">Galeria</a></li>
              <li><a href="tratamentos.html">Tratamentos</a></li>
              <li><a href="#Produtos">Produtos</a></li>
              <li><a href="index.html#Sobre">Sobre</a></li>
            </ul>
          </nav>
        </section>

        <section class="btn-contato">
          <a href="index.html#contacto">
            <button>Contato</button>
          </a>
        </section>
      </div>
  </header>

  <!-- Formulário de Marcações -->
  <main class="marcacoes">
    <h1>Agende o seu Tratamento</h1>
    <form class="form-marcacao" action="https://formspree.io/f/mblkvqor" method="POST">
      
      <label for="nome">Nome completo</label>
      <input type="text" id="nome" name="nome" required>

      <label for="email">E-mail</label>
      <input type="email" id="email" name="email" required>

      <label for="telefone">Telefone</label>
      <input type="tel" id="telefone" name="telefone" required>

      <label for="tratamento">Escolha o tratamento</label>
      <select id="tratamento" name="tratamento" required>
        <option value="">Selecione...</option>
        <option>Limpeza de Pele Profunda</option>
        <option>Limpeza de Pele Normal</option>
        <option>Limpeza de Pele Master</option>
        <option>Revitalização com Vitamina C</option>
        <option>Microagulhamento Facial</option>
        <option>Dermaplaning</option>
        <option>HydraGloss</option>
        <option>Esfoliação Corporal</option>
        <option>Drenagem Linfática</option>
        <option>Banho de Lua</option>
        <option>Depilação Laser</option>
      </select>

      <label for="data">Data</label>
      <input type="date" id="data" name="data" required>

      <label for="hora">Hora</label>
      <select id="hora" name="hora" required>
        <option value="">Selecione…</option>
        <!-- Apenas os 7 horários/slots permitidos (início de cada bloco) -->
        <option value="09:00">09:00 (09:00 - 10:30)</option>
        <option value="10:30">10:30 (10:30 - 12:00)</option>
        <option value="12:30">12:30 (12:30 - 14:00)</option>
        <option value="14:00">14:00 (14:00 - 15:30)</option>
        <option value="15:30">15:30 (15:30 - 17:00)</option>
        <option value="17:00">17:00 (17:00 - 18:30)</option>
        <option value="18:30">18:30 (18:30 - 20:00)</option>
      </select>


      <label for="mensagem">Observações</label>
      <textarea id="mensagem" name="mensagem" rows="4" placeholder="Alguma observação? (opcional)"></textarea>

      <button type="submit">Confirmar Marcação</button>
    </form>
  </main>

<div class="Volta_top"> 
      <a href="#"><button class="Top"><i class="fas fa-arrow-up"></i></button></a>
  </div>

  <!-- Rodapé -->
  <footer class="footer-bottom">
    <p>© 2025 Beleza & Estética - Todos os direitos reservados.</p>
  </footer>

</body>

<script>
  // Elementos
  const inputData = document.getElementById('data');
  const selectHora = document.getElementById('hora');
  const form = document.querySelector('.form-marcacao');

  // Definir o mínimo como hoje
  const hoje = new Date().toISOString().split('T')[0];
  inputData.min = hoje;

  // Guardar textos originais das opções para evitar '— Reservado' duplicado
  const originalOptionText = {};
  Array.from(selectHora.options).forEach(opt => { originalOptionText[opt.value] = opt.textContent; });

  // Funções de armazenamento
  function loadBookings() {
    try { return JSON.parse(localStorage.getItem('bookings') || '{}'); }
    catch (e) { console.error('Erro a carregar bookings', e); return {}; }
  }

  function saveBookings(bookings) { localStorage.setItem('bookings', JSON.stringify(bookings)); }

  // Atualiza disponibilidade das opções com base nas reservas da data
  function updateAvailableSlots(date) {
    // restaura textos e habilita
    Array.from(selectHora.options).forEach(opt => {
      opt.disabled = false;
      // restaura texto original (usa chave vazia para label 'Selecione…')
      opt.textContent = originalOptionText[opt.value] || opt.textContent.replace(' — Reservado', '');
    });

    if (!date) return;

    const bookings = loadBookings();
    const reserved = bookings[date] || [];

    // desabilita opções reservadas
    Array.from(selectHora.options).forEach(opt => {
      if (reserved.includes(opt.value) && opt.value !== '') {
        opt.disabled = true;
        opt.textContent = (originalOptionText[opt.value] || opt.textContent) + ' — Reservado';
      }
    });

    // se já houver 7 reservas, desabilita todo o select (exceto a opção vazia)
    if (reserved.length >= 7) {
      selectHora.disabled = true;
      selectHora.title = 'Limite de 7 marcações atingido para esta data';
    } else {
      selectHora.disabled = false;
      selectHora.title = '';
    }
  }

  // Bloquear domingos e atualizar slots quando a data muda
  inputData.addEventListener('input', function() {
    if (!this.value) { updateAvailableSlots(''); return; }
    const valor = new Date(this.value + 'T00:00');
    const diaSemana = valor.getDay(); // 0=Domingo
    if (diaSemana === 0) {
      alert('Não aceitamos marcações ao domingo. Escolha de segunda a sábado.');
      this.value = '';
      updateAvailableSlots('');
      return;
    }
    updateAvailableSlots(this.value);
  });

  // Validação no submit: impede dois agendamentos para a mesma data+hora
  form.addEventListener('submit', function(e) {
    const data = inputData.value;
    const hora = selectHora.value;

    if (!data || !hora) {
      alert('Escolha data e hora válidas antes de confirmar.');
      e.preventDefault();
      return;
    }

    const bookings = loadBookings();
    bookings[data] = bookings[data] || [];

    if (bookings[data].includes(hora)) {
      alert('Esse horário já foi reservado para esta data. Escolha outro horário ou outra data.');
      e.preventDefault();
      updateAvailableSlots(data);
      return;
    }

    // Adiciona a reserva localmente para bloquear o horário em futuros envios no mesmo navegador
    bookings[data].push(hora);
    saveBookings(bookings);

    // Permitir que o formulário seja submetido ao Formspree (ou backend). Se preferir, pode usar fetch para enviar.
    // Nota: esta é uma verificação client-side. Para evitar reservas duplicadas entre utilizadores, implemente
    // a verificação/armazenamento no servidor ou em um serviço compartilhado (ex.: Google Calendar, Firebase, DB).
  });

  // Inicializa disponibilidade (quando a página carrega e se já houver data preenchida)
  document.addEventListener('DOMContentLoaded', () => {
    if (inputData.value) updateAvailableSlots(inputData.value);
  });

  // Menu hamburguer (mantido)
  const toggle = document.getElementById('menu-toggle');
  const menuDesktop = document.querySelector('.menu-desktop');

  toggle.addEventListener('click', (e) => {
    e.stopPropagation();
    menuDesktop.classList.toggle('active');
    toggle.innerHTML = menuDesktop.classList.contains('active')
      ? '<i class="fas fa-times"></i>'
      : '<i class="fas fa-bars"></i>';
  });

  document.addEventListener('click', (e) => {
    if (menuDesktop.classList.contains('active') && !menuDesktop.contains(e.target) && e.target !== toggle) {
      menuDesktop.classList.remove('active');
      toggle.innerHTML = '<i class="fas fa-bars"></i>';
    }
  });

  menuDesktop.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      if (menuDesktop.classList.contains('active')) {
        menuDesktop.classList.remove('active');
        toggle.innerHTML = '<i class="fas fa-bars"></i>';
      }
    });
  });
</script>

</html>
